# SecureView - Система видеонаблюдения

Профессиональная система видеонаблюдения с поддержкой до 20 камер и интеллектуальной детекцией движения.

## Возможности

### Управление камерами
- Поддержка до 20 камер одновременно
- Одно подключение на камеру (оптимизация ресурсов)
- Поддержка RTSP/RTP/HTTP потоков
- Авторизация на камерах (логин/пароль)

### Детекция движения
- Алгоритм MOG2 (Mixture of Gaussians)
- Настраиваемые параметры:
  - История кадров (100-1000)
  - Порог дисперсии (1-50)
  - Количество гауссовых компонент (1-10)
  - Детекция теней
- Минимальная площадь объекта (игнорирование шума)
- Исключение зон из детекции (полигоны)
- Игнорирование движений короче 0-10 секунд
- **Предзапись (0-30 сек)**: запись начнется ДО обнаружения движения
- **Постзапись (0-60 сек)**: запись продолжится ПОСЛЕ окончания движения

### Запись видео
- Непрерывная запись
- Запись по движению
- Настраиваемый путь сохранения
- Максимальная длительность файла (5-180 минут)
- Автоматическое сохранение метаданных
- Формат: MJPEG (AVI) с автоконвертацией в H.264 (MP4) для браузера

### Live просмотр
- Просмотр в реальном времени через WebSocket
- Автоматическое переподключение при обрыве связи
- Оптимизация потока (JPEG compression)
- Минимальная задержка (~2-3 секунды)

### Плеер записей
- Ускоренное воспроизведение: x1, x2, x4, x6, x8, x10
- Фильтрация по:
  - Камере
  - Дате (начало/конец)
  - Типу записи (непрерывная/по движению)
- Скачивание записей
- Удаление записей

### Telegram интеграция
- Уведомления о движении
- Отправка видео клипов (сжатые и ускоренные)
- Настройка бота и чата в интерфейсе

### Производительность
- 3 профиля производительности:
  - **Слабые системы**: 640px, 10 FPS, JPEG 50%
  - **Средние системы**: 1280px, 15 FPS, JPEG 70%
  - **Мощные системы**: 1920px, 25 FPS, JPEG 85%

## Технологии

**Backend:**
- FastAPI
- OpenCV (cv2) для обработки видео
- MOG2 алгоритм детекции движения
- Motor (async MongoDB)
- WebSocket для live streaming
- Python Telegram Bot
- FFmpeg для конвертации видео

**Frontend:**
- React 19
- Tailwind CSS
- Shadcn UI
- Lucide Icons
- Axios

**Database:**
- MongoDB

**Deployment:**
- Docker & Docker Compose
- Ubuntu 22.04 base (для совместимости OpenCV)

## Установка с Docker

### Предварительные требования
- Docker
- Docker Compose

### Запуск

```bash
# Клонировать репозиторий
git clone <repository-url>
cd secureview

# Запустить все сервисы
docker-compose up -d --build

# Проверить статус
docker-compose ps

# Просмотр логов
docker-compose logs -f
```

### Доступ
- **Frontend**: http://localhost:3000
- **Backend API**: http://localhost:8001
- **MongoDB**: localhost:27017

### Остановка
```bash
docker-compose down
```

### Остановка с удалением данных
```bash
docker-compose down -v
```

### Важно
При первом запуске Docker автоматически:
- Установит все зависимости (включая FFmpeg для конвертации видео)
- Создаст необходимые директории
- Настроит сеть между сервисами
- Видео будут записываться в формате MJPEG (.avi) и автоматически конвертироваться в H.264 MP4 при воспроизведении

## Настройка

### 1. Добавление камеры
1. Откройте веб-интерфейс
2. Нажмите "Добавить камеру"
3. Укажите название, URL и данные авторизации

Пример URL:
```
rtsp://admin:password@192.168.1.100:554/stream
```

### 2. Настройка детекции движения
1. Откройте настройки камеры
2. Перейдите на вкладку "Движение"
3. Включите детекцию
4. Настройте параметры MOG2

### 3. Telegram уведомления
1. Создайте бота через @BotFather
2. Получите ID чата через @userinfobot
3. Введите данные в глобальных настройках
4. Включите уведомления в настройках камеры

## Тестовая камера

Для тестирования системы используйте:

```
URL: rtsp://admin:L25CE51E@62.181.56.178:8080/cam/realmonitor?channel=1&subtype=0&unicast=true&proto=Onvif
Логин: admin
Пароль: L25CE51E
```

## Структура проекта

```
.
├── backend/
│   ├── server.py              # FastAPI приложение
│   ├── models.py              # Pydantic модели
│   ├── camera_manager.py     # Менеджер камер
│   ├── requirements.txt      # Python зависимости
│   ├── Dockerfile
│   └── .env
├── frontend/
│   ├── src/
│   │   ├── pages/
│   │   │   ├── Dashboard.jsx
│   │   │   ├── CameraView.jsx
│   │   │   ├── Recordings.jsx
│   │   │   └── Settings.jsx
│   │   ├── components/
│   │   │   ├── Layout.jsx
│   │   │   ├── CameraSettingsDialog.jsx
│   │   │   └── ui/
│   │   ├── App.js
│   │   └── App.css
│   ├── package.json
│   ├── Dockerfile
│   └── .env
├── docker-compose.yml
└── README.md
```

## Производительность

### Рекомендуемые характеристики

**Слабые системы (5-10 камер):**
- CPU: 4 ядра
- RAM: 4 GB
- HDD: 500 GB+

**Средние системы (10-15 камер):**
- CPU: 8 ядер
- RAM: 8 GB
- SSD: 1 TB+

**Мощные системы (15-20 камер):**
- CPU: 16 ядер
- RAM: 16 GB
- SSD: 2 TB+

## API Документация

Автоматическая API документация доступна по адресу:
- Swagger UI: http://localhost:8001/docs
- ReDoc: http://localhost:8001/redoc

## Лицензия

MIT License

## Поддержка

Для вопросов и предложений создайте issue в репозитории.
